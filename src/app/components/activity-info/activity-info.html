<div class="activity-card terminal-window">
  <div class="terminal-header">
    <div class="window-info">
      @if (activity.metaLabel) {
        <span class="meta-tag">{{ activity.metaLabel }}</span>
      }
      <span class="filename">{{ activity.name | lowercase }}.service</span>
    </div>
    <div class="window-meta">
      <span class="date-tag">[{{ dateRange }}]</span>
    </div>
  </div>

  <div class="terminal-body">
    <div class="commit-section">
      <div class="commit-header">
        <span class="hash">commit {{ sysInfo.hash }}</span>
        <span class="ref">(HEAD -> main)</span>
      </div>
      <div class="subject">{{ activity.subtitle }}</div>
      <p class="description-text">{{ activity.description }}</p>
    </div>

    @if (activity.tags; as tags) {
      <div class="tags-wrapper">
        <div class="tag-row">
          <span class="cli-prompt">$</span>
          @for (tag of tags.core; track tag) {
            <span class="cli-flag">--{{ tag }}</span>
          }
          
          @if (hasAdditionalTags) {
            <button class="expand-btn" (click)="toggleAdditionalTags()">
              {{ showAdditionalTags ? 'collapse' : '...' }}
            </button>
          }
        </div>

        @if (showAdditionalTags && tags.additional) {
          <div class="tag-row additional fade-in">
            @for (tag of tags.additional; track tag) {
              <span class="cli-flag secondary">--{{ tag }}</span>
            }
          </div>
        }
      </div>
    }

    @if (activity.attachments.length) {
      <div class="attachment-zone" #attachmentContainer>
        <button class="ls-cmd" [class.active]="showAttachments" (click)="toggleAttachments()">
          <span class="icon">üìÅ</span> ls -la ./resources/
        </button>

        @if (showAttachments) {
          <div class="ls-output fade-in">
            <div class="ls-line header">total {{ activity.attachments.length }}</div>
            @for (item of activity.attachments; track item.name) {
              <a [href]="item.url" target="_blank" class="ls-line item">
                @let isLink = isExternalLink(item.url);
                
                <span class="perms">{{ isLink ? 'lrwxrwxrwx' : '-rw-r--r--' }}</span>
                <span class="owner">dev</span>
                
                <div class="file-path">
                  <span class="file-name" [class.symlink]="isLink">{{ item.name }}</span>
                  @if (isLink) {
                    <span class="link-arrow">-></span>
                    <span class="link-dest">{{ item.url }}</span>
                  }
                </div>
              </a>
            }
          </div>
        }
      </div>
    }
  </div>
</div>